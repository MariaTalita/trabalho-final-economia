# Carregar as bibliotecas
library(WDI)
library(dplyr)
library(ggplot2)

# Buscar os dados de gastos com saúde
grafico <- WDI(country = "all", 
               indicator = "SH.XPD.CHEX.GD.ZS", 
               start = 2000, end = 2021)

# Filtrar dados válidos
grafcorte <- grafico %>%
  filter(!is.na(SH.XPD.CHEX.GD.ZS))

# Selecionar os 6 países com MAIORES GASTOS EM SAÚDE no ano mais recente disponível (ex: 2021)
top_paises <- grafcorte %>%
  filter(year == 2021) %>%
  arrange(desc(SH.XPD.CHEX.GD.ZS)) %>%
  slice(1:6) %>%
  pull(country)

# Filtrar novamente os dados apenas desses países
dados_filtrados <- grafcorte %>%
  filter(country %in% top_paises)

# Gráfico 1: Gastos ao longo dos anos
ggplot(dados_filtrados, aes(x = year, y = SH.XPD.CHEX.GD.ZS, color = country)) +
  geom_line() +
  labs(title = "Gastos Públicos com Saúde (% do PIB)",
       x = "Ano",
       y = "Gastos em Saúde (% PIB)",
       color = "País") +
  theme_minimal()

# Gráfico 2: Pontos
ggplot(dados_filtrados, aes(x = year, y = SH.XPD.CHEX.GD.ZS, color = country)) +
  geom_point(size = 2) +
  labs(title = "Gastos Públicos com Saúde (% do PIB)",
       x = "Ano",
       y = "Gastos em Saúde (% PIB)",
       color = "País") +
  theme_minimal()

# Gráfico 3: Barras (somente para o ano de 2021)
dados_2021 <- dados_filtrados %>% filter(year == 2021)

ggplot(dados_2021, aes(x = reorder(country, SH.XPD.CHEX.GD.ZS), 
                       y = SH.XPD.CHEX.GD.ZS, fill = country)) +
  geom_bar(stat = "identity") +
  labs(title = "Top 6 países com maiores gastos em saúde em 2021",
       x = "País",
       y = "Gastos em Saúde (% PIB)") +
  theme_minimal() +
  theme(legend.position = "none")
